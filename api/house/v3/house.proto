syntax = "proto3";

package api.house.v3;
import "google/api/annotations.proto";
option go_package = "anjuke/api/house/v3;v3";
option java_multiple_files = true;
option java_package = "api.house.v3";
option java_outer_classname = "HouseProtoV3";

service House {
  // 普通推荐列表
  rpc RecommendList (HouseRecommendRequest) returns (HouseRecommendReply) {
    option (google.api.http) = {
      get: "/house/recommend"
    };
  }

  // 个性化推荐列表，根据用户浏览习惯推荐
  rpc PersonalRecommendList (PersonalRecommendRequest) returns (HouseRecommendReply) {
    option (google.api.http) = {
      get: "/house/personal-recommend"
    };
  }

  // 预约看房
  rpc ReserveHouse (ReserveHouseRequest) returns (ReserveHouseReply) {
    option (google.api.http) = {
      post: "/house/reserve"
      body: "*"
    };
  }
  
  // 发起在线聊天
  rpc StartChat (StartChatRequest) returns (StartChatReply) {
    option (google.api.http) = {
      post: "/house/chat/start"
      body: "*"
    };
  }

  // 收藏房源
  rpc FavoriteHouse (FavoriteHouseRequest) returns (FavoriteHouseReply) {
    option (google.api.http) = {
      post: "/house/favorite"
      body: "*"
    };
  }

  // 取消收藏房源
  rpc UnfavoriteHouse (UnfavoriteHouseRequest) returns (UnfavoriteHouseReply) {
    option (google.api.http) = {
      delete: "/house/favorite"
    };
  }

  // 获取收藏列表
  rpc GetFavoriteList (GetFavoriteListRequest) returns (GetFavoriteListReply) {
    option (google.api.http) = {
      get: "/house/favorites"
    };
  }

  // 检查收藏状态
  rpc CheckFavoriteStatus (CheckFavoriteStatusRequest) returns (CheckFavoriteStatusReply) {
    option (google.api.http) = {
      get: "/house/favorite/status"
    };
  }
 
}

// 普通推荐请求
message HouseRecommendRequest {
  int32 page = 1;        // 页码
  int32 page_size = 2;   // 每页数量
}

// 个性化推荐请求
message PersonalRecommendRequest {
  int64 user_id = 1;     // 用户ID
  int32 page = 2;        // 页码
  int32 page_size = 3;   // 每页数量
}

// 标准响应结构
message BaseResponse {
  int32 code = 1;        // 状态码，0表示成功
  string msg = 2;        // 消息
}

// 推荐列表数据
message HouseRecommendData {
  int64 total = 1;       // 总数
  repeated HouseRecommendItem list = 2; // 房源列表
}

// 推荐列表响应
message HouseRecommendReply {
  int32 code = 1;        // 状态码，0表示成功
  string msg = 2;        // 消息
  HouseRecommendData data = 3; // 数据
}

message HouseRecommendItem {
  // house_id字段已完全移除
  string title = 1;
  string description = 2;
  double price = 3;
  double area = 4;
  string layout = 5;
  string image_url = 6;
}

// 预约看房请求
message ReserveHouseRequest {
  int64 landlord_id = 1;      // 房东ID
  int64 user_id = 2;          // 预约人ID
  string user_name = 3;       // 预约人姓名
  int64 house_id = 4;         // 房源ID
  string house_title = 5;     // 房源标题
  string reserve_time = 6;    // 预约时间
}

// 预约数据
message ReserveHouseData {
  bool success = 1;          // 是否成功
  int64 reservation_id = 2;  // 预约ID
}

// 预约看房响应
message ReserveHouseReply {
  int32 code = 1;            // 状态码，0表示成功
  string msg = 2;            // 消息
  ReserveHouseData data = 3; // 数据
}

// WebSocket消息类型枚举
enum MessageType {
  UNKNOWN = 0;
  RESERVATION_CREATED = 1;    // 预约创建
  RESERVATION_CONFIRMED = 2;  // 预约确认
  RESERVATION_CANCELLED = 3;  // 预约取消
  RESERVATION_REMINDER = 4;   // 预约提醒
}

// WebSocket消息结构
message WebSocketMessage {
  MessageType type = 1;           // 消息类型
  int64 user_id = 2;             // 接收用户ID
  int64 reservation_id = 3;       // 预约ID
  string title = 4;              // 消息标题
  string content = 5;            // 消息内容
  int64 timestamp = 6;           // 时间戳
  ReservationDetail detail = 7;   // 预约详情
}

// 预约详情
message ReservationDetail {
  int64 reservation_id = 1;       // 预约ID
  int64 house_id = 2;            // 房源ID
  string house_title = 3;        // 房源标题
  int64 landlord_id = 4;         // 房东ID
  string landlord_name = 5;      // 房东姓名
  int64 user_id = 6;             // 预约人ID
  string user_name = 7;          // 预约人姓名
  string reserve_time = 8;       // 预约时间
  string status = 9;             // 预约状态
  int64 created_at = 10;         // 创建时间
  string chat_id = 11;           // 聊天ID，用于在线聊天
}

// 聊天消息类型
enum ChatMessageType {
  CHAT_TEXT = 0;       // 文本消息
  CHAT_IMAGE = 1;      // 图片消息
  CHAT_VOICE = 2;      // 语音消息
  CHAT_LOCATION = 3;   // 位置消息
  CHAT_SYSTEM = 4;     // 系统消息
}

// 聊天消息
message ChatMessage {
  string chat_id = 1;           // 聊天ID
  int64 sender_id = 2;          // 发送者ID
  string sender_name = 3;       // 发送者名称
  int64 receiver_id = 4;        // 接收者ID
  string receiver_name = 5;     // 接收者名称
  ChatMessageType type = 6;     // 消息类型
  string content = 7;           // 消息内容
  int64 timestamp = 8;          // 时间戳
  bool read = 9;                // 是否已读
}

// 发起聊天请求
message StartChatRequest {
  int64 reservation_id = 1;     // 预约ID
  int64 user_id = 2;            // 用户ID
  int64 landlord_id = 3;        // 房东ID
  string initial_message = 4;   // 初始消息
}

// 发起聊天响应
message StartChatReply {
  int32 code = 1;               // 状态码
  string msg = 2;               // 消息
  StartChatData data = 3;       // 数据
}

// 发起聊天数据
message StartChatData {
  string chat_id = 1;           // 聊天ID
  bool success = 2;             // 是否成功
}

// 收藏房源请求
message FavoriteHouseRequest {
  int64 user_id = 1;    // 用户ID
  int64 house_id = 2;   // 房源ID
}

// 收藏房源响应
message FavoriteHouseReply {
  int32 code = 1;       // 状态码
  string msg = 2;       // 消息
  FavoriteHouseData data = 3; // 数据
}

message FavoriteHouseData {
  bool success = 1;     // 是否成功
  int64 favorite_id = 2; // 收藏ID
}

// 取消收藏请求
message UnfavoriteHouseRequest {
  int64 user_id = 1;    // 用户ID
  int64 house_id = 2;   // 房源ID
}

// 取消收藏响应
message UnfavoriteHouseReply {
  int32 code = 1;       // 状态码
  string msg = 2;       // 消息
  UnfavoriteHouseData data = 3; // 数据
}

message UnfavoriteHouseData {
  bool success = 1;     // 是否成功
}

// 获取收藏列表请求
message GetFavoriteListRequest {
  int64 user_id = 1;    // 用户ID
  int32 page = 2;       // 页码
  int32 page_size = 3;  // 每页数量
}

// 获取收藏列表响应
message GetFavoriteListReply {
  int32 code = 1;       // 状态码
  string msg = 2;       // 消息
  FavoriteListData data = 3; // 数据
}

message FavoriteListData {
  int64 total = 1;      // 总数
  repeated FavoriteHouseItem list = 2; // 收藏房源列表
}

message FavoriteHouseItem {
  int64 favorite_id = 1;     // 收藏ID
  int64 house_id = 2;        // 房源ID
  string title = 3;          // 房源标题
  string description = 4;    // 房源描述
  double price = 5;          // 价格
  double area = 6;           // 面积
  string layout = 7;         // 户型
  string image_url = 8;      // 图片URL
  int64 favorite_time = 9;   // 收藏时间戳
}

// 检查收藏状态请求
message CheckFavoriteStatusRequest {
  int64 user_id = 1;         // 用户ID
  repeated int64 house_ids = 2; // 房源ID列表
}

// 检查收藏状态响应
message CheckFavoriteStatusReply {
  int32 code = 1;            // 状态码
  string msg = 2;            // 消息
  FavoriteStatusData data = 3; // 数据
}

message FavoriteStatusData {
  map<int64, bool> status_map = 1; // 房源ID -> 收藏状态映射
}
